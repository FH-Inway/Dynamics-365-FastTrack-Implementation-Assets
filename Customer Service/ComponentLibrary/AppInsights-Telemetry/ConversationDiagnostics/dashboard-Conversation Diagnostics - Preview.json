{"$schema":"https://dataexplorer.azure.com/static/d/schema/52/dashboard.json","id":"c2b5c269-7a15-4043-9894-2624b1e68d50","eTag":"864704c8-d430-40ed-92b4-40aed4fdc235","schema_version":"52","title":"Conversation Diagnostics - Preview","tiles":[{"id":"922c2983-549e-44fc-84aa-4e91717bb1b8","title":"Conversation State Flow","visualType":"table","pageId":"24083b1f-cba8-4bfb-ac11-b956a385b0fb","layout":{"x":0,"y":21,"width":18,"height":9},"queryRef":{"kind":"query","queryId":"c616953d-0591-4408-9c1f-a0c31580c208"},"visualOptions":{"table__enableRenderLinks":true,"colorRulesDisabled":true,"colorStyle":"light","crossFilterDisabled":false,"drillthroughDisabled":false,"crossFilter":[],"drillthrough":[],"table__renderLinks":[],"colorRules":[]}},{"id":"5328c1aa-225c-4975-83ca-e888b3aacf11","title":"Fallback Queue Routing","visualType":"table","pageId":"24083b1f-cba8-4bfb-ac11-b956a385b0fb","layout":{"x":0,"y":0,"width":9,"height":7},"queryRef":{"kind":"query","queryId":"0af0830b-8ef0-4ace-b6d6-f5fe0d617f9d"},"visualOptions":{"table__enableRenderLinks":true,"colorRulesDisabled":true,"colorStyle":"light","crossFilterDisabled":false,"drillthroughDisabled":false,"crossFilter":[],"drillthrough":[],"table__renderLinks":[],"colorRules":[]}},{"id":"5635075d-bab5-4572-8845-8ed8634cd174","title":"Overflow Triggered for Conversations","visualType":"table","pageId":"24083b1f-cba8-4bfb-ac11-b956a385b0fb","layout":{"x":9,"y":0,"width":9,"height":7},"queryRef":{"kind":"query","queryId":"e4da85dc-277b-485d-8053-bbd5e3166422"},"visualOptions":{"table__enableRenderLinks":true,"colorRulesDisabled":true,"colorStyle":"light","crossFilterDisabled":false,"drillthroughDisabled":false,"crossFilter":[],"drillthrough":[],"table__renderLinks":[],"colorRules":[]}},{"id":"3bed1bc9-58a8-475f-926c-d0a83fb95ae0","title":"Agents Rejected Conversation Multiple Times","visualType":"table","pageId":"24083b1f-cba8-4bfb-ac11-b956a385b0fb","layout":{"x":0,"y":7,"width":9,"height":7},"queryRef":{"kind":"query","queryId":"dd27b79e-ad04-474c-9004-8b787f0b53e4"},"visualOptions":{"table__enableRenderLinks":true,"colorRulesDisabled":true,"colorStyle":"light","crossFilterDisabled":false,"drillthroughDisabled":false,"crossFilter":[],"drillthrough":[],"table__renderLinks":[],"colorRules":[]}},{"id":"23a1214d-8169-487b-a58d-1d28c3aad67f","title":"Agent Assignment Took Longer Than 2 Minutes","visualType":"table","pageId":"24083b1f-cba8-4bfb-ac11-b956a385b0fb","layout":{"x":9,"y":7,"width":9,"height":7},"queryRef":{"kind":"query","queryId":"ce25a52b-1f91-4141-9eb8-8352562e9552"},"visualOptions":{"table__enableRenderLinks":true,"colorRulesDisabled":true,"colorStyle":"light","crossFilterDisabled":false,"drillthroughDisabled":false,"crossFilter":[],"drillthrough":[],"table__renderLinks":[],"colorRules":[]}},{"id":"62e91aee-90c0-4b52-b0fa-2ab9f6feb9a8","title":"Agent Handle Time Took Longer Than 5 Minutes","visualType":"table","pageId":"24083b1f-cba8-4bfb-ac11-b956a385b0fb","layout":{"x":9,"y":14,"width":9,"height":7},"queryRef":{"kind":"query","queryId":"a04d99fb-0aa1-40ee-9d0f-b0bde2b7d4be"},"visualOptions":{"table__enableRenderLinks":true,"colorRulesDisabled":true,"colorStyle":"light","crossFilterDisabled":false,"drillthroughDisabled":false,"crossFilter":[],"drillthrough":[],"table__renderLinks":[],"colorRules":[]}},{"id":"fe0593a6-655f-4e02-97fd-687e11479f1c","title":"Top 20 AgentIDs with high reject count","visualType":"bar","pageId":"24083b1f-cba8-4bfb-ac11-b956a385b0fb","layout":{"x":0,"y":14,"width":9,"height":7},"queryRef":{"kind":"query","queryId":"314eb882-42a7-4adf-b832-e700c7a11fc8"},"visualOptions":{"multipleYAxes":{"base":{"id":"-1","label":"","columns":[],"yAxisMaximumValue":null,"yAxisMinimumValue":null,"yAxisScale":"linear","horizontalLines":[]},"additional":[],"showMultiplePanels":false},"hideLegend":false,"legendLocation":"bottom","xColumnTitle":"","xColumn":null,"yColumns":null,"seriesColumns":null,"xAxisScale":"linear","verticalLine":"","crossFilterDisabled":false,"drillthroughDisabled":false,"crossFilter":[],"drillthrough":[]}}],"baseQueries":[],"parameters":[{"kind":"duration","id":"ffb0c03e-88ea-4de1-a371-b8718400bee8","displayName":"Time range","description":"","beginVariableName":"_startTime","endVariableName":"_endTime","defaultValue":{"kind":"dynamic","count":1,"unit":"hours"},"showOnPages":{"kind":"all"}},{"kind":"string","selectionType":"freetext","id":"1b7d18e0-0bf0-4d85-8a81-6b7d7f167f40","displayName":"ConversationId","variableName":"_converstaionId","description":"","defaultValue":{"kind":"all"},"showOnPages":{"kind":"selection","pageIds":["c9a54acc-f7b2-4deb-a739-56441c9d5f75"]}}],"dataSources":[{"id":"5dcd886c-e898-4585-bdef-fbdce577cf08","kind":"manual-kusto","scopeId":"kusto","name":"<Provide-Database-Name>","clusterUri":"https://ade.applicationinsights.io/subscriptions/<SubscriptionId>","database":"<Provide-Database-Name>"}],"pages":[{"name":"Conversation Diagnostics","id":"24083b1f-cba8-4bfb-ac11-b956a385b0fb"}],"queries":[{"dataSource":{"kind":"inline","dataSourceId":"5dcd886c-e898-4585-bdef-fbdce577cf08"},"text":"traces\n| where timestamp >= _startTime and timestamp <= _endTime\n| extend customDim = parse_json(customDimensions)\n| extend conversationId = tostring(customDim[\"powerplatform.analytics.resource.id\"]), subscenario = tostring(customDim[\"powerplatform.analytics.subscenario\"])\n| where conversationId != \"\" and subscenario != \"\"\n| project timestamp, conversationId, subscenario\n| sort by timestamp asc\n| summarize make_list(subscenario) by conversationId\n| project conversationId, conversationFlow = strcat_array(list_subscenario, \" -> \")","id":"c616953d-0591-4408-9c1f-a0c31580c208","usedVariables":["_endTime","_startTime"]},{"dataSource":{"kind":"inline","dataSourceId":"5dcd886c-e898-4585-bdef-fbdce577cf08"},"text":"traces\n| where timestamp >= _startTime and timestamp <= _endTime\n| extend customDim = parse_json(customDimensions)\n| extend conversationId = tostring(customDim[\"powerplatform.analytics.resource.id\"]), \n         subscenario = tostring(customDim[\"powerplatform.analytics.subscenario\"]),\n         queueResult = parse_json(tostring(customDim[\"omnichannel.result\"])).DisplayName\n| where subscenario == \"RTQ\" and queueResult == \"va_chat_queue\" \n| project timestamp, conversationId, queueResult\n","id":"0af0830b-8ef0-4ace-b6d6-f5fe0d617f9d","usedVariables":["_endTime","_startTime"]},{"dataSource":{"kind":"inline","dataSourceId":"5dcd886c-e898-4585-bdef-fbdce577cf08"},"text":"traces\n| where timestamp >= _startTime and timestamp <= _endTime\n| extend customDim = parse_json(customDimensions)\n| extend conversationId = tostring(customDim[\"powerplatform.analytics.resource.id\"]),\n         subscenario = tostring(customDim[\"powerplatform.analytics.subscenario\"])\n| extend omnichannelAdditionalInfo = tostring((customDim[\"omnichannel.additional_info\"]))\n| where omnichannelAdditionalInfo contains \"OverflowTrigger\"\n| project timestamp, conversationId, subscenario, omnichannelAdditionalInfo\n//add queue, and action","id":"e4da85dc-277b-485d-8053-bbd5e3166422","usedVariables":["_endTime","_startTime"]},{"dataSource":{"kind":"inline","dataSourceId":"5dcd886c-e898-4585-bdef-fbdce577cf08"},"text":"traces\n| where timestamp >= _startTime and timestamp <= _endTime\n| extend customDim = parse_json(customDimensions)\n| extend conversationId = tostring(customDim[\"powerplatform.analytics.resource.id\"]), \n         subscenario = tostring(customDim[\"powerplatform.analytics.subscenario\"]),\n         agentId = tostring(customDim[\"omnichannel.target_agent.id\"]) // Extract agent ID from custom dimensions\n| where subscenario == \"AgentReject\"\n| summarize agentRejectionCount = count() by conversationId, agentId // Count rejections per agent per conversation\n| summarize rejectionCount = sum(agentRejectionCount), \n            agentRejectionDetails = make_list(pack('agentId', agentId, 'rejectionCount', agentRejectionCount)) \n    by conversationId // Aggregate results by conversation\n| where rejectionCount > 1 // Filter conversations with more than one rejection\n| project conversationId, rejectionCount, agentRejectionDetails\n\n\n\n\n\n//traces\n//| where timestamp >= _startTime and timestamp <= _endTime\n//| extend customDim = parse_json(customDimensions)\n//| extend conversationId = tostring(customDim[\"powerplatform.analytics.resource.id\"]), \n //        subscenario = tostring(customDim[\"powerplatform.analytics.subscenario\"])\n//| where subscenario == \"AgentReject\"\n//| summarize rejectionCount = count() by conversationId\n//| where rejectionCount > 1\n//| project conversationId, rejectionCount\n\n//add agentid and for every agent can reject so the count of reject for every agentid\n//for example\n//fd29c594-8989-4582-8e4f-b9ea8acc3bc8, agent1, 2, \n//fd29c594-8989-4582-8e4f-b9ea8acc3bc8, agent2, 1,","id":"dd27b79e-ad04-474c-9004-8b787f0b53e4","usedVariables":["_endTime","_startTime"]},{"dataSource":{"kind":"inline","dataSourceId":"5dcd886c-e898-4585-bdef-fbdce577cf08"},"text":"// Extract relevant subscenarios\nlet subscenarios = traces\n| where timestamp >= _startTime and timestamp <= _endTime\n| extend customDim = parse_json(customDimensions)\n| extend conversationId = tostring(customDim[\"powerplatform.analytics.resource.id\"]),\n         subscenario = tostring(customDim[\"powerplatform.analytics.subscenario\"])\n| where subscenario in (\"RTQ\", \"AgentAccept\")\n| project timestamp, conversationId, subscenario;\n// Find the latest RTQ before each AgentAccept\nlet latestRTQsBeforeAgentAccept = subscenarios\n| where subscenario == \"RTQ\"\n| join kind=inner (\n    subscenarios\n    | where subscenario == \"AgentAccept\"\n    | project agentAcceptTime = timestamp, conversationId\n) on conversationId\n| where timestamp < agentAcceptTime // Ensure RTQ is before AgentAccept\n| summarize latestRTQTime = max(timestamp) by conversationId, agentAcceptTime;\n// Calculate assignment time\nlatestRTQsBeforeAgentAccept\n| extend assignmentTime = agentAcceptTime - latestRTQTime\n| where assignmentTime > 2min\n| project conversationId, assignmentTime\n\n\n//| extend prevTimestamp = prev(timestamp), prevSubscenario = prev(subscenario)\n//| where prevSubscenario == \"RTQ\" and subscenario == \"AgentAccept\"\n//| extend assignmentTime = timestamp - prevTimestamp\n//| where assignmentTime > 2min\n//| project conversationId, assignmentTime\n\n//take the closest RTQ to the AgentAccept","id":"ce25a52b-1f91-4141-9eb8-8352562e9552","usedVariables":["_endTime","_startTime"]},{"dataSource":{"kind":"inline","dataSourceId":"5dcd886c-e898-4585-bdef-fbdce577cf08"},"text":"traces\n| where timestamp >= _startTime and timestamp <= _endTime\n| extend customDim = parse_json(customDimensions)\n| extend conversationId = tostring(customDim[\"powerplatform.analytics.resource.id\"]),\n         subscenario = tostring(customDim[\"powerplatform.analytics.subscenario\"])\n| where subscenario in (\"AgentAccept\", \"CustomerEndConversation\",\"AgentEndConversation\") \n| project timestamp, conversationId, subscenario\n| sort by conversationId, timestamp asc\n| extend prevTimestamp = prev(timestamp), prevSubscenario = prev(subscenario)\n| where prevSubscenario == \"AgentAccept\" and (subscenario == \"CustomerEndConversation\" or subscenario == \"AgentEndConversation\")\n| extend handleTime = timestamp - prevTimestamp\n| where handleTime > 5min\n| project conversationId, handleTime","id":"a04d99fb-0aa1-40ee-9d0f-b0bde2b7d4be","usedVariables":["_endTime","_startTime"]},{"dataSource":{"kind":"inline","dataSourceId":"5dcd886c-e898-4585-bdef-fbdce577cf08"},"text":"traces\n| where timestamp >= _startTime and timestamp <= _endTime\n| extend customDim = parse_json(customDimensions)\n| extend agentId = tostring(customDim[\"omnichannel.target_agent.id\"]), // Extract agent ID from custom dimensions\n         subscenario = tostring(customDim[\"powerplatform.analytics.subscenario\"])\n| where subscenario == \"AgentReject\"\n| summarize totalRejections = count() by agentId // Count total rejections for each agent\n| sort by totalRejections desc // Sort by rejection count in descending order\n| top 20 by totalRejections // Select top 20 agents\n| project agentId, totalRejections // Project relevant columns\n\n","id":"314eb882-42a7-4adf-b832-e700c7a11fc8","usedVariables":["_endTime","_startTime"]}]}